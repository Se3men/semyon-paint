(this["webpackJsonppaint-online"]=this["webpackJsonppaint-online"]||[]).push([[0],{36:function(t,e,s){},58:function(t,e,s){},84:function(t,e,s){},85:function(t,e,s){"use strict";s.r(e);var n=s(0),i=s(14),a=s.n(i),o=(s(36),s(4)),c=s(5),r=s(6),h=new(function(){function t(){Object(o.a)(this,t),this.tool=null,Object(r.d)(this)}return Object(c.a)(t,[{key:"setTool",value:function(t){this.tool=t}},{key:"setFillColor",value:function(t){this.tool.fillColor=t}},{key:"setStrokeColor",value:function(t){this.tool.strokeColor=t}},{key:"setLineWidth",value:function(t){this.tool.lineWidth=t}}]),t}()),u=s(1),l=function(){return Object(u.jsxs)("div",{className:"setting-bar",children:[Object(u.jsx)("label",{htmlFor:"line-width",children:"\u0422\u043e\u043b\u0449\u0438\u043d\u0430 \u043b\u0438\u043d\u0438\u0438"}),Object(u.jsx)("input",{onChange:function(t){return h.setLineWidth(t.target.value)},style:{margin:"0 10px"},id:"line-width",type:"number",defaultValue:1,min:1,max:50}),Object(u.jsx)("label",{htmlFor:"stroke-color",children:"\u0426\u0432\u0435\u0442 \u043e\u0431\u0432\u043e\u0434\u043a\u0438"}),Object(u.jsx)("input",{onChange:function(t){return h.setStrokeColor(t.target.value)},id:"stroke-color",type:"color"})]})},d=s(16),f=s(15),v=function(){function t(e,s,n){Object(o.a)(this,t),this.canvas=e,this.socket=s,this.id=n,this.ctx=e.getContext("2d"),this.destroyEvents()}return Object(c.a)(t,[{key:"fillColor",set:function(t){this.ctx.fillStyle=t}},{key:"strokeColor",set:function(t){this.ctx.strokeStyle=t}},{key:"lineWidth",set:function(t){this.ctx.lineWidth=t}},{key:"destroyEvents",value:function(){this.canvas.onmouseup=null,this.canvas.onmousedown=null,this.canvas.onmousemove=null}}]),t}(),b=function(t){Object(d.a)(s,t);var e=Object(f.a)(s);function s(t,n,i){var a;return Object(o.a)(this,s),(a=e.call(this,t,n,i)).listen(),a}return Object(c.a)(s,[{key:"listen",value:function(){this.canvas.onmouseup=this.mouseUpHandler.bind(this),this.canvas.onmousedown=this.mouseDownHandler.bind(this),this.canvas.onmousemove=this.mouseMoveHandler.bind(this)}},{key:"mouseUpHandler",value:function(t){this.mouseDown=!1,this.socket.send(JSON.stringify({method:"draw",id:this.id,figure:{type:"finish"}}))}},{key:"mouseDownHandler",value:function(t){this.mouseDown=!0,this.ctx.beginPath(),this.ctx.moveTo(t.pageX-t.target.offsetLeft,t.pageY-t.target.offsetTop)}},{key:"mouseMoveHandler",value:function(t){this.mouseDown&&this.socket.send(JSON.stringify({method:"draw",id:this.id,figure:{type:"brush",x:t.pageX-t.target.offsetLeft,y:t.pageY-t.target.offsetTop}}))}}],[{key:"draw",value:function(t,e,s){t.lineTo(e,s),t.stroke()}}]),s}(v),m=function(t){Object(d.a)(s,t);var e=Object(f.a)(s);function s(t,n,i){var a;return Object(o.a)(this,s),(a=e.call(this,t,n,i)).listen(),a}return Object(c.a)(s,[{key:"listen",value:function(){this.canvas.onmouseup=this.mouseUpHandler.bind(this),this.canvas.onmousedown=this.mouseDownHandler.bind(this),this.canvas.onmousemove=this.mouseMoveHandler.bind(this)}},{key:"mouseUpHandler",value:function(t){this.mouseDown=!1,this.socket.send(JSON.stringify({method:"draw",id:this.id,figure:{type:"rect",x:this.startX,y:this.startY,width:this.width,height:this.height,color:this.ctx.fillStyle}}))}},{key:"mouseDownHandler",value:function(t){this.mouseDown=!0,this.ctx.beginPath(),this.startX=t.pageX-t.target.offsetLeft,this.startY=t.pageY-t.target.offsetTop,this.saved=this.canvas.toDataURL()}},{key:"mouseMoveHandler",value:function(t){if(this.mouseDown){var e=t.pageX-t.target.offsetLeft,s=t.pageY-t.target.offsetTop;this.width=e-this.startX,this.height=s-this.startY,this.draw(this.startX,this.startY,this.width,this.height)}}},{key:"draw",value:function(t,e,s,n){var i=this,a=new Image;a.src=this.saved,a.onload=function(){i.ctx.clearRect(0,0,i.canvas.width,i.canvas.height),i.ctx.drawImage(a,0,0,i.canvas.width,i.canvas.height),i.ctx.beginPath(),i.ctx.rect(t,e,s,n),i.ctx.fill(),i.ctx.stroke()}}}],[{key:"staticDraw",value:function(t,e,s,n,i,a){t.fillStyle=a,t.beginPath(),t.rect(e,s,n,i),t.fill(),t.stroke()}}]),s}(v),g=s(23),w=s.n(g),p=s(28),j=function(t){Object(d.a)(s,t);var e=Object(f.a)(s);function s(t,n,i){var a;return Object(o.a)(this,s),(a=e.call(this,t,n,i)).listen(),a}return Object(c.a)(s,[{key:"listen",value:function(){this.canvas.onmouseup=this.mouseUpHandler.bind(this),this.canvas.onmousedown=this.mouseDownHandler.bind(this),this.canvas.onmousemove=this.mouseMoveHandler.bind(this)}},{key:"mouseUpHandler",value:function(t){this.mouseDown=!1,this.socket.send(JSON.stringify({method:"draw",id:this.id,figure:{type:"circle",x:this.startX,y:this.startY,radius:this.radius,color:this.ctx.fillStyle}}))}},{key:"mouseDownHandler",value:function(t){this.mouseDown=!0,this.ctx.beginPath(),this.startX=t.pageX-t.target.offsetLeft,this.startY=t.pageY-t.target.offsetTop,this.saved=this.canvas.toDataURL()}},{key:"mouseMoveHandler",value:function(t){if(this.mouseDown){var e=t.pageX-t.target.offsetLeft,s=t.pageY-t.target.offsetTop;this.width=e-this.startX,this.height=s-this.startY,this.radius=Math.sqrt(Math.pow(this.width,2)+Math.pow(this.height,2)),this.draw(this.startX,this.startY,this.radius)}}},{key:"draw",value:function(t,e,s){var n=new Image;n.src=this.saved,n.onload=Object(p.a)(w.a.mark((function i(){return w.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.drawImage(n,0,0,this.canvas.width,this.canvas.height),this.ctx.beginPath(),this.ctx.arc(t,e,s,0,2*Math.PI),this.ctx.fill(),this.ctx.stroke();case 6:case"end":return i.stop()}}),i,this)}))).bind(this)}}],[{key:"staticCircleDraw",value:function(t,e,s,n,i){t.fillStyle=i,t.beginPath(),t.arc(e,s,n,0,2*Math.PI),t.fill(),t.stroke()}}]),s}(v),k=function(t){Object(d.a)(s,t);var e=Object(f.a)(s);function s(t,n,i){var a;return Object(o.a)(this,s),(a=e.call(this,t,n,i)).listen(),a}return Object(c.a)(s,[{key:"listen",value:function(){this.canvas.onmouseup=this.mouseUpHandler.bind(this),this.canvas.onmousedown=this.mouseDownHandler.bind(this),this.canvas.onmousemove=this.mouseMoveHandler.bind(this)}},{key:"mouseUpHandler",value:function(t){this.mouseDown=!1,this.socket.send(JSON.stringify({method:"draw",id:this.id,figure:{type:"finish"}}))}},{key:"mouseDownHandler",value:function(t){this.mouseDown=!0,this.ctx.beginPath(),this.ctx.moveTo(t.pageX-t.target.offsetLeft,t.pageY-t.target.offsetTop)}},{key:"mouseMoveHandler",value:function(t){this.mouseDown&&this.socket.send(JSON.stringify({method:"draw",id:this.id,figure:{type:"eraser",x:t.pageX-t.target.offsetLeft,y:t.pageY-t.target.offsetTop}}))}}],[{key:"eraserDraw",value:function(t,e,s){t.strokeStyle="white",t.lineTo(e,s),t.stroke()}}]),s}(b),y=function(t){Object(d.a)(s,t);var e=Object(f.a)(s);function s(t,n,i){var a;return Object(o.a)(this,s),(a=e.call(this,t,n,i)).listen(),a.name="Line",a}return Object(c.a)(s,[{key:"listen",value:function(){this.canvas.onmouseup=this.mouseUpHandler.bind(this),this.canvas.onmousedown=this.mouseDownHandler.bind(this),this.canvas.onmousemove=this.mouseMoveHandler.bind(this)}},{key:"mouseUpHandler",value:function(t){this.mouseDown=!1,this.socket.send(JSON.stringify({method:"draw",id:this.id,figure:{type:"line",x:this.startX,y:this.startY,color:this.ctx.fillStyle}}))}},{key:"mouseDownHandler",value:function(t){this.mouseDown=!0,this.ctx.beginPath(),this.ctx.moveTo(this.currentX,this.currentY),this.saved=this.canvas.toDataURL(),this.currentX=t.pageX-t.target.offsetLeft,this.currentY=t.pageY-t.target.offsetTop}},{key:"mouseMoveHandler",value:function(t){this.mouseDown&&this.draw(t.pageX-t.target.offsetLeft,t.pageY-t.target.offsetTop)}},{key:"draw",value:function(t,e){var s=new Image;s.src=this.saved,s.onload=Object(p.a)(w.a.mark((function n(){return w.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.drawImage(s,0,0,this.canvas.width,this.canvas.height),this.ctx.beginPath(),this.ctx.moveTo(this.currentX,this.currentY),this.ctx.lineTo(t,e),this.ctx.stroke();case 6:case"end":return n.stop()}}),n,this)}))).bind(this)}}],[{key:"lineDraw",value:function(t,e,s,n){t.fillStyle=n,t.beginPath(),t.moveTo(e,s),t.fill(),t.stroke()}}]),s}(v),x=new(function(){function t(){Object(o.a)(this,t),this.canvas=null,this.socket=null,this.sessionid=null,this.undoList=[],this.redoList=[],this.username="",Object(r.d)(this)}return Object(c.a)(t,[{key:"setSessionId",value:function(t){this.sessionid=t}},{key:"setSocket",value:function(t){this.socket=t}},{key:"setCanvas",value:function(t){this.canvas=t}},{key:"setUsername",value:function(t){this.username=t}},{key:"pushToUndo",value:function(t){this.undoList.push(t)}},{key:"pushToRedo",value:function(t){this.redoList.push(t)}},{key:"undo",value:function(){var t=this,e=this.canvas.getContext("2d");if(this.undoList.length>0){var s=this.undoList.pop();this.redoList.push(this.canvas.toDataURL());var n=new Image;n.src=s,n.onload=function(){e.clearRect(0,0,t.canvas.width,t.canvas.height),e.drawImage(n,0,0,t.canvas.width,t.canvas.height)}}else e.clearRect(0,0,this.canvas.width,this.canvas.height)}},{key:"redo",value:function(){var t=this,e=this.canvas.getContext("2d");if(this.redoList.length>0){var s=this.redoList.pop();this.undoList.push(this.canvas.toDataURL());var n=new Image;n.src=s,n.onload=function(){e.clearRect(0,0,t.canvas.width,t.canvas.height),e.drawImage(n,0,0,t.canvas.width,t.canvas.height)}}}}]),t}()),O=function(){return Object(u.jsxs)("div",{className:"toolbar",children:[Object(u.jsx)("button",{className:"toolbar__btn brush",onClick:function(){return h.setTool(new b(x.canvas,x.socket,x.sessionid))}}),Object(u.jsx)("button",{className:"toolbar__btn rect",onClick:function(){return h.setTool(new m(x.canvas,x.socket,x.sessionid))}}),Object(u.jsx)("button",{className:"toolbar__btn circle",onClick:function(){return h.setTool(new j(x.canvas,x.socket,x.sessionid))}}),Object(u.jsx)("button",{className:"toolbar__btn eraser",onClick:function(){return h.setTool(new k(x.canvas,x.socket,x.sessionid))}}),Object(u.jsx)("button",{className:"toolbar__btn line",onClick:function(){return h.setTool(new y(x.canvas,x.socket,x.sessionid))}}),Object(u.jsx)("input",{onChange:function(t){return function(t){h.setStrokeColor(t.target.value),h.setFillColor(t.target.value)}(t)},style:{marginLeft:10},type:"color"}),Object(u.jsx)("button",{className:"toolbar__btn undo",onClick:function(){return x.undo()}}),Object(u.jsx)("button",{className:"toolbar__btn redo",onClick:function(){return x.redo()}}),Object(u.jsx)("button",{className:"toolbar__btn save",onClick:function(){return function(){var t=x.canvas.toDataURL();console.log(t);var e=document.createElement("a");e.href=t,e.download=x.sessionid+".png",document.body.appendChild(e),e.click(),document.body.removeChild(e)}()}})]})},D=s(11),C=(s(58),s(50)),H=s(88),L=s(89),T=s(3),S=s(33),U=s.n(S),X=Object(C.a)((function(){var t=Object(n.useRef)(),e=Object(n.useRef)(),s=Object(n.useState)(!0),i=Object(D.a)(s,2),a=i[0],o=i[1],c=Object(T.g)();Object(n.useEffect)((function(){x.setCanvas(t.current);var e=t.current.getContext("2d");U.a.get("https://semyon-paint.herokuapp.com/image?id=".concat(c.id)).then((function(s){var n=new Image;n.src=s.data,n.onload=function(){e.clearRect(0,0,t.current.width,t.current.height),e.drawImage(n,0,0,t.current.width,t.current.height)}}))}),[]),Object(n.useEffect)((function(){if(x.username){var e=new WebSocket("wss://semyon-paint.herokuapp.com/");x.setSocket(e),x.setSessionId(c.id),h.setTool(new b(t.current,e,c.id)),e.onopen=function(){e.send(JSON.stringify({id:c.id,username:x.username,method:"connection"}))},e.onmessage=function(t){var e=JSON.parse(t.data);switch(e.method){case"connection":console.log("user ".concat(e.username," connected!!!!"));break;case"draw":r(e)}}}}),[x.username]);var r=function(e){var s=e.figure,n=t.current.getContext("2d");switch(s.type){case"brush":b.draw(n,s.x,s.y);break;case"rect":m.staticDraw(n,s.x,s.y,s.width,s.height,s.color);break;case"circle":j.staticCircleDraw(n,s.x,s.y,s.radius,s.color);break;case"eraser":k.eraserDraw(n,s.x,s.y);break;case"line":y.lineDraw(n,s.x,s.y,s.color);break;case"finish":n.beginPath()}};return Object(u.jsxs)("div",{className:"canvas",children:[Object(u.jsxs)(H.a,{show:a,onHide:function(){},children:[Object(u.jsx)(H.a.Header,{children:Object(u.jsx)(H.a.Title,{children:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0432\u0430\u0448\u0435 \u0438\u043c\u044f"})}),Object(u.jsx)(H.a.Body,{children:Object(u.jsx)("input",{type:"text",ref:e})}),Object(u.jsx)(H.a.Footer,{children:Object(u.jsx)(L.a,{variant:"secondary",onClick:function(){return x.setUsername(e.current.value),void o(!1)},children:"\u0412\u043e\u0439\u0442\u0438"})})]}),Object(u.jsx)("canvas",{onMouseDown:function(){return x.pushToUndo(t.current.toDataURL()),void U.a.post("https://semyon-paint.herokuapp.com/image?id=".concat(c.id),{img:t.current.toDataURL()}).then((function(t){return console.log(t.data)}))},ref:t,width:600,height:400})]})})),Y=(s(84),s(32)),N=function(){return Object(u.jsx)(Y.a,{children:Object(u.jsx)("div",{className:"app",children:Object(u.jsxs)(T.d,{children:[Object(u.jsxs)(T.b,{path:"/:id",children:[Object(u.jsx)(O,{}),Object(u.jsx)(l,{}),Object(u.jsx)(X,{})]}),Object(u.jsx)(T.a,{to:"f".concat((+new Date).toString(16))})]})})})};a.a.render(Object(u.jsx)(N,{}),document.getElementById("root"))}},[[85,1,2]]]);
//# sourceMappingURL=main.82fb7997.chunk.js.map